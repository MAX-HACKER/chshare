<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css"> @import url(https://themes.googleusercontent.com/fonts/css?kit=kbffV7V9BIH3Ot2AQ2LQRA);</style></head><body class="doc-content" style="background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt"><p style="padding:0;margin:0;color:#000000;font-size:11pt;font-family:&quot;Arial&quot;;line-height:1.0;text-align:left"><span style="color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:&quot;Courier&quot;;font-style:normal">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br><br>&lt;head&gt;<br> &nbsp; &nbsp;&lt;meta charset=&quot;UTF-8&quot;&gt;<br> &nbsp; &nbsp;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br> &nbsp; &nbsp;&lt;title&gt;ChargeFranchise - EV Charging Platform&lt;/title&gt;<br> &nbsp; &nbsp;&lt;!-- Tailwind CSS for styling. NOTE: For production, it&#39;s recommended to install Tailwind via NPM/CLI. --&gt;<br> &nbsp; &nbsp;&lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;<br> &nbsp; &nbsp;&lt;!-- Google Fonts --&gt;<br> &nbsp; &nbsp;&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;<br> &nbsp; &nbsp;&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot; crossorigin&gt;<br> &nbsp; &nbsp;&lt;link href=&quot;https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;<br> &nbsp; &nbsp;&lt;!-- Chart.js for data visualization --&gt;<br> &nbsp; &nbsp;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/chart.js&quot;&gt;&lt;/script&gt;<br> &nbsp; &nbsp;<br> &nbsp; &nbsp;&lt;style&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;body {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-family: &#39;Inter&#39;, sans-serif;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.section, .vendor-tab-content { display: none; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.section.active, .vendor-tab-content.active { display: block; animation: fadeIn 0.8s ease-in-out; }<br> &nbsp; &nbsp; &nbsp; &nbsp;@keyframes fadeIn {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from { opacity: 0; transform: translateY(10px); }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to { opacity: 1; transform: translateY(0); }<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.message-box {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed; top: 20px; right: 20px;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padding: 1rem 2rem; border-radius: 8px; z-index: 3001;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transform: translateX(120%); opacity: 0; display: none;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.message-box.show { transform: translateX(0); opacity: 1; display: flex; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.message-box.info { background-color: #3b82f6; color: white; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.message-box.success { background-color: #16a34a; color: white; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.message-box.error { background-color: #dc2626; color: white; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.custom-scrollbar::-webkit-scrollbar { width: 8px; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.custom-scrollbar::-webkit-scrollbar-track { background: #e2e8f0; border-radius: 10px; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.custom-scrollbar::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }<br> &nbsp; &nbsp; &nbsp; &nbsp;.modal-overlay {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: fixed; top: 0; left: 0; right: 0; bottom: 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: rgba(0, 0, 0, 0.5);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display: flex; align-items: center; justify-content: center;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;z-index: 3000;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.vendor-tab.active {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-color: #6366f1; /* indigo-500 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: #4f46e5; /* indigo-600 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;font-weight: 600;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.sort-btn.active-sort {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #4f46e5; /* indigo-600 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;color: white;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;/* Ensure map container has a defined height */<br> &nbsp; &nbsp; &nbsp; &nbsp;#live-navigation {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;height: calc(100vh - 150px); /* Full viewport height minus header/padding */<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;/* Style for alternative route options */<br> &nbsp; &nbsp; &nbsp; &nbsp;.route-option {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border: 2px solid transparent;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;transition: all 0.3s ease;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;.route-option.selected-route {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;border-color: #4f46e5; /* indigo-600 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;background-color: #e0e7ff; /* indigo-100 */<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;box-shadow: 0 4px 12px rgba(0,0,0,0.1);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;&lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body class=&quot;bg-gray-100 font-sans min-h-screen flex flex-col&quot;&gt;<br> &nbsp; &nbsp;&lt;!-- Message Box for feedback --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;message-box&quot; class=&quot;message-box&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;message-text&quot;&gt;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;hideMessage()&quot; class=&quot;text-white text-xl ml-4&quot;&gt;&times;&lt;/button&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Edit Charger Modal --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;edit-charger-modal&quot; class=&quot;modal-overlay hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-white p-8 rounded-lg shadow-xl w-full max-w-md&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-bold mb-6 text-gray-800&quot;&gt;Edit Charger&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;edit-charger-form&quot; class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;hidden&quot; id=&quot;edit-charger-id&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;edit-charger-name&quot; placeholder=&quot;Charger Name&quot; class=&quot;w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;edit-charger-rate&quot; placeholder=&quot;Charging Rate (kW)&quot; class=&quot;w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;edit-charger-status&quot; class=&quot;w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;available&quot;&gt;Available&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;in-use&quot;&gt;In Use&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;maintenance&quot;&gt;Maintenance&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex gap-4 pt-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;update-charger-btn&quot; onclick=&quot;updateCharger()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors&quot;&gt;Update Charger&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;closeEditModal()&quot; class=&quot;w-full bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors&quot;&gt;Cancel&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br><br> &nbsp; &nbsp;&lt;!-- Authentication Section --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;auth-section&quot; class=&quot;flex items-center justify-center min-h-screen p-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Forms are rendered here by JS --&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp;&lt;!-- Main Application --&gt;<br> &nbsp; &nbsp;&lt;div id=&quot;app-content&quot; class=&quot;flex flex-col flex-grow&quot; style=&quot;display: none;&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;header class=&quot;bg-white bg-opacity-10 backdrop-blur-lg p-4 sticky top-0 z-10 shadow-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Navigation Bar --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;nav class=&quot;container mx-auto flex justify-between items-center&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;logo text-2xl font-bold text-white&quot;&gt;&#9889; ChargeFranchise&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;ul class=&quot;nav-links hidden md:flex items-center gap-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- User Links --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;home&#39;)&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;find-chargers&#39;)&quot;&gt;AI Route Planner&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;chargers-near-me&#39;)&quot;&gt;Chargers Near Me&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;vehicle-reg&#39;)&quot;&gt;My Vehicles&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;rent-charger&#39;)&quot;&gt;Rent My Charger&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;become-vendor&#39;)&quot;&gt;Become a Partner&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Vendor Links --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;performance-overview&#39;);&quot;&gt;Performance Overview&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;manage-chargers&#39;);&quot;&gt;Manage Chargers&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;my-vmap&#39;);&quot;&gt;My VMAP&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;vendor-settings&#39;);&quot;&gt;Settings&lt;/a&gt;&lt;/li&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;li id=&quot;user-info-container&quot; class=&quot;flex items-center gap-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span id=&quot;user-info&quot; class=&quot;text-white&quot;&gt;&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;logout()&quot; class=&quot;bg-red-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-red-600&quot;&gt;Logout&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/ul&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button class=&quot;text-white text-2xl md:hidden&quot; onclick=&quot;toggleMobileMenu()&quot;&gt;&#9776;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/nav&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Mobile Menu --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;ul id=&quot;mobile-menu&quot; class=&quot;hidden md:hidden mt-4 space-y-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- User Links --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;home&#39;); toggleMobileMenu();&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;find-chargers&#39;); toggleMobileMenu();&quot;&gt;AI Route Planner&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;chargers-near-me&#39;); toggleMobileMenu();&quot;&gt;Chargers Near Me&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;vehicle-reg&#39;); toggleMobileMenu();&quot;&gt;My Vehicles&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;rent-charger&#39;); toggleMobileMenu();&quot;&gt;Rent My Charger&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;user-only-nav&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;become-vendor&#39;); toggleMobileMenu();&quot;&gt;Become a Partner&lt;/a&gt;&lt;/li&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Vendor Links --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;performance-overview&#39;); toggleMobileMenu();&quot;&gt;Performance Overview&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;manage-chargers&#39;); toggleMobileMenu();&quot;&gt;Manage Chargers&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;my-vmap&#39;); toggleMobileMenu();&quot;&gt;My VMAP&lt;/a&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;vendor-only-nav&quot; style=&quot;display: none;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;block text-white font-medium p-2&quot; onclick=&quot;showSection(&#39;dashboard&#39;); showVendorTab(&#39;vendor-settings&#39;); toggleMobileMenu();&quot;&gt;Settings&lt;/a&gt;&lt;/li&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;li class=&quot;pt-2&quot;&gt;&lt;button onclick=&quot;logout()&quot; class=&quot;w-full bg-red-500 text-white py-2 px-4 rounded-full font-semibold hover:bg-red-600&quot;&gt;Logout&lt;/button&gt;&lt;/li&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/ul&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/header&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;main class=&quot;main-content container mx-auto p-4 flex-grow bg-white rounded-xl shadow-lg mt-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Home Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;home&quot; class=&quot;section active&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-indigo-600 text-white p-10 rounded-xl text-center shadow-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h1 class=&quot;text-4xl font-bold mb-4&quot;&gt;The Future of EV Charging is Collaborative&lt;/h1&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-xl opacity-90&quot;&gt;Plan smart routes, manage your vehicles, and join our network of chargers.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-white p-6 rounded-lg shadow-md border-t-4 border-indigo-500 transition-all duration-300 hover:shadow-xl&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-semibold text-gray-800 mb-2&quot;&gt;My Vehicles&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;showSection(&#39;vehicle-reg&#39;)&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Manage Vehicles&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-white p-6 rounded-lg shadow-md border-t-4 border-purple-500 transition-all duration-300 hover:shadow-xl&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-semibold text-gray-800 mb-2&quot;&gt;AI Route Planner&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;showSection(&#39;find-chargers&#39;)&quot; class=&quot;w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700&quot;&gt;Plan Trip&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;franchise-card&quot; class=&quot;bg-white p-6 rounded-lg shadow-md border-t-4 border-yellow-500 transition-all duration-300 hover:shadow-xl&quot; style=&quot;display: none;&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-semibold text-gray-800 mb-2&quot;&gt;Become a Partner&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-gray-600 mb-4&quot;&gt;Earn by setting up your own charging station franchise.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;showSection(&#39;become-vendor&#39;)&quot; class=&quot;w-full bg-yellow-500 text-white py-3 rounded-lg font-semibold hover:bg-yellow-600&quot;&gt;Apply Now&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- AI Route Planner Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;find-chargers&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;p-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold mb-4 text-gray-800&quot;&gt;AI Route Planner&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;grid grid-cols-1 lg:grid-cols-3 gap-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;lg:col-span-1 p-6 bg-gray-50 rounded-lg shadow-inner space-y-4&quot; id=&quot;route-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold text-gray-700&quot;&gt;Plan your journey&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Start Location&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center gap-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; id=&quot;route-start&quot; placeholder=&quot;e.g. Mumbai&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick=&quot;locateMe(&#39;route-start&#39;)&quot; class=&quot;bg-gray-200 p-2 rounded-lg hover:bg-gray-300 transition-colors&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; class=&quot;h-6 w-6 text-gray-600&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;path d=&quot;M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z&quot; /&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;circle cx=&quot;12&quot; cy=&quot;10&quot; r=&quot;3&quot; /&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/svg&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- NEW: Waypoints UI --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;waypoints-container&quot; class=&quot;space-y-2&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Add Waypoint (for long trips)&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center gap-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;waypoint-input&quot; placeholder=&quot;e.g. Delhi&quot; class=&quot;w-full p-3 border rounded-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;addWaypoint()&quot; class=&quot;bg-gray-200 p-2 rounded-lg hover:bg-gray-300 transition-colors font-bold text-lg&quot;&gt;+&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Destination&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;route-end&quot; placeholder=&quot;e.g. Pune&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Select Your Vehicle&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;vehicle-select&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;start-charge&quot; class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Starting Charge: &lt;span id=&quot;start-charge-value&quot;&gt;80&lt;/span&gt;%&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;range&quot; id=&quot;start-charge&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;80&quot; class=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;end-charge&quot; class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Desired Charge at Arrival: &lt;span id=&quot;end-charge-value&quot;&gt;20&lt;/span&gt;%&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;range&quot; id=&quot;end-charge&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;20&quot; class=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;search-radius&quot; class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Charger Search Radius: &lt;span id=&quot;search-radius-value&quot;&gt;10&lt;/span&gt; km&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;range&quot; id=&quot;search-radius&quot; min=&quot;5&quot; max=&quot;50&quot; value=&quot;10&quot; step=&quot;5&quot; class=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;nearby-radius&quot; class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Nearby Places Radius: &lt;span id=&quot;nearby-radius-value&quot;&gt;1&lt;/span&gt; km&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;range&quot; id=&quot;nearby-radius&quot; min=&quot;1&quot; max=&quot;5&quot; value=&quot;1&quot; step=&quot;1&quot; class=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;find-route-btn&quot; onclick=&quot;findAlternativeRoutes()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors&quot;&gt;Find Available Routes&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;lg:col-span-2 space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;route-details&quot; class=&quot;p-4 bg-blue-50 rounded-lg hidden&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;map&quot; class=&quot;w-full h-[500px] rounded-lg shadow-md&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Nearby Places will be shown here after selecting a charger --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;nearby-places&quot; class=&quot;p-4 bg-gray-50 rounded-lg hidden&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Chargers Near Me Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;chargers-near-me&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold mb-4 text-gray-800&quot;&gt;EV Chargers Near Me&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center justify-between mb-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-gray-600&quot;&gt;Find the closest available chargers around your location.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;locateMe(&#39;near-me-map&#39;)&quot; class=&quot;bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors flex items-center gap-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; class=&quot;h-5 w-5&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;path d=&quot;M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z&quot; /&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;circle cx=&quot;12&quot; cy=&quot;10&quot; r=&quot;3&quot; /&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/svg&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Locate Me<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;chargers-near-me-map&quot; class=&quot;w-full h-[600px] rounded-lg shadow-md&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Live Navigation Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;live-navigation&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 h-full flex flex-col relative&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-between items-center mb-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold text-gray-800&quot;&gt;Live Navigation&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex items-center gap-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button id=&quot;mute-btn&quot; onclick=&quot;toggleMute()&quot; class=&quot;bg-gray-200 text-gray-700 p-2 rounded-full font-semibold hover:bg-gray-300 transition-colors&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Speaker Icon will be injected by JS --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;stopInAppNavigation()&quot; class=&quot;bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors&quot;&gt;Stop Navigation&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Info box for selected nearby place --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;selected-place-info&quot; class=&quot;absolute top-20 left-1/2 -translate-x-1/2 z-10 bg-white p-3 rounded-lg shadow-lg hidden&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-bold text-indigo-600&quot;&gt;Visiting:&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p id=&quot;selected-place-text&quot; class=&quot;text-sm&quot;&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Turn-by-turn directions panel --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;turn-by-turn-directions&quot; class=&quot;absolute top-20 left-4 z-10 bg-white p-4 rounded-lg shadow-lg w-full max-w-sm&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Directions will be injected here by JS --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;live-navigation-map&quot; class=&quot;w-full rounded-lg shadow-md flex-grow&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- My Vehicles Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;vehicle-reg&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;p-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold mb-4 text-gray-800&quot;&gt;My Vehicles&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 gap-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot; id=&quot;vehicle-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Add a New Vehicle&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;reg-no&quot; placeholder=&quot;Registration No. (e.g. MH01AB1234)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;vehicle-make&quot; placeholder=&quot;Make (e.g. Tesla)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;vehicle-model&quot; placeholder=&quot;Model (e.g. Model 3)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;battery-capacity&quot; placeholder=&quot;Battery Capacity (kWh)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;connector-type&quot; placeholder=&quot;Connector Type (e.g. CCS2)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;submit-vehicle-btn&quot; onclick=&quot;submitVehicle()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Register Vehicle&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner custom-scrollbar overflow-y-auto max-h-96&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;My Registered Vehicles&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;my-vehicles-list&quot; class=&quot;space-y-3&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Rent My Charger Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;rent-charger&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold mb-4 text-gray-800&quot;&gt;Rent Your Home Charger&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;mb-6 text-gray-600&quot;&gt;Earn extra income by listing your personal EV charger for others to use when you&#39;re not.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 gap-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot; id=&quot;home-charger-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;List Your Charger&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;home-charger-name&quot; placeholder=&quot;Charger Nickname (e.g. My Home Charger)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;home-charger-rate&quot; placeholder=&quot;Charging Rate (kW)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;home-charger-address&quot; placeholder=&quot;Your Full Address&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;home-charger-type&quot; placeholder=&quot;Connector Type&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;list-charger-btn&quot; onclick=&quot;listHomeCharger()&quot; class=&quot;w-full bg-teal-600 text-white py-3 rounded-lg font-semibold hover:bg-teal-700&quot;&gt;List My Charger&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner custom-scrollbar overflow-y-auto max-h-96&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;My Listed Chargers&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;user-chargers-list&quot; class=&quot;space-y-3&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;!-- Become a Vendor Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;become-vendor&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;p-6 max-w-2xl mx-auto&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-3xl font-bold mb-4 text-gray-800&quot;&gt;Become a Vendor Partner&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;vendor-application-status&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;!-- Vendor Dashboard Section --&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;section id=&quot;dashboard&quot; class=&quot;section&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;border-b border-gray-200 mb-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;nav class=&quot;-mb-px flex space-x-8&quot; aria-label=&quot;Tabs&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a href=&quot;#&quot; onclick=&quot;showVendorTab(&#39;performance-overview&#39;)&quot; class=&quot;vendor-tab active border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm&quot;&gt;Performance Overview&lt;/a&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a href=&quot;#&quot; onclick=&quot;showVendorTab(&#39;manage-chargers&#39;)&quot; class=&quot;vendor-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm&quot;&gt;Manage Chargers&lt;/a&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a href=&quot;#&quot; onclick=&quot;showVendorTab(&#39;my-vmap&#39;)&quot; class=&quot;vendor-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm&quot;&gt;My VMAP&lt;/a&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a href=&quot;#&quot; onclick=&quot;showVendorTab(&#39;vendor-settings&#39;)&quot; class=&quot;vendor-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm&quot;&gt;Settings&lt;/a&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/nav&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;performance-overview&quot; class=&quot;vendor-tab-content active&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-2xl font-bold mb-4 text-gray-800&quot;&gt;Performance Overview&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 gap-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Monthly Earnings&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;canvas id=&quot;chargingChart&quot;&gt;&lt;/canvas&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot; id=&quot;roi-calculator&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Return on Investment (ROI) Calculator&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;investment&quot; placeholder=&quot;Total Investment (&#8377;)&quot; class=&quot;w-full p-3 border rounded-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;monthly-revenue&quot; placeholder=&quot;Avg. Monthly Revenue (&#8377;)&quot; class=&quot;w-full p-3 border rounded-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;calculateROI()&quot; class=&quot;w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700&quot;&gt;Calculate Annual ROI&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;roi-result&quot; class=&quot;mt-4 p-4 bg-blue-100 rounded-lg hidden&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;manage-chargers&quot; class=&quot;vendor-tab-content&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;grid grid-cols-1 lg:grid-cols-2 gap-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;My Franchise Chargers&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;vendor-chargers-list&quot; class=&quot;space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner&quot; id=&quot;vendor-charger-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Add a New Franchise Charger&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;charger-name&quot; placeholder=&quot;Charger Name&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;charger-rate&quot; placeholder=&quot;Charging Rate (kW)&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;charger-lat&quot; placeholder=&quot;Latitude&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;number&quot; id=&quot;charger-lng&quot; placeholder=&quot;Longitude&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;connector-type-select&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;&quot;&gt;Select Connector Type&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;CCS2&quot;&gt;CCS2&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;CHAdeMO&quot;&gt;CHAdeMO&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;Type 2 AC&quot;&gt;Type 2 AC&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;3-pin plug&quot;&gt;3-pin plug&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;select id=&quot;charger-type-select&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;&quot;&gt;Select Charger Type&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;AC Slow&quot;&gt;AC Slow&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;AC Fast&quot;&gt;AC Fast&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;option value=&quot;DC Fast&quot;&gt;DC Fast Charger&lt;/option&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/select&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;add-charger-btn&quot; onclick=&quot;addCharger()&quot; class=&quot;w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700&quot;&gt;Add Charger&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;my-vmap&quot; class=&quot;vendor-tab-content&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 class=&quot;text-2xl font-bold mb-4 text-gray-800&quot;&gt;My Charger Locations&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;vendor-map&quot; class=&quot;w-full h-[500px] rounded-lg shadow-md&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;vendor-settings&quot; class=&quot;vendor-tab-content&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-2xl font-bold mb-4 text-gray-800&quot;&gt;Vendor Settings&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner max-w-md mx-auto&quot; id=&quot;set-pin-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Set Your Custom PIN&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-gray-600 mb-4&quot;&gt;This PIN will be used for all future logins.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;new-pin&quot; placeholder=&quot;New PIN&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;confirm-pin&quot; placeholder=&quot;Confirm New PIN&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;setCustomPin()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Set PIN&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner max-w-md mx-auto mt-6&quot; id=&quot;change-pin-form&quot; style=&quot;display:none;&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Change Your PIN&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;current-pin&quot; placeholder=&quot;Current PIN&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;change-new-pin&quot; placeholder=&quot;New PIN&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;change-confirm-pin&quot; placeholder=&quot;Confirm New PIN&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;changeCustomPin()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Change PIN&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-6 bg-gray-50 rounded-lg shadow-inner max-w-md mx-auto mt-6&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h3 class=&quot;text-xl font-semibold mb-3 text-gray-700&quot;&gt;Open Charge Map API Key&lt;/h3&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-gray-600 mb-4&quot;&gt;Enter your Open Charge Map API key for global charger data.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;ocm-api-key&quot; placeholder=&quot;Enter API Key&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/section&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;&lt;/main&gt;<br> &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp;<br> &nbsp; &nbsp;&lt;!-- Main Application Script --&gt;<br> &nbsp; &nbsp;&lt;script type=&quot;module&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp;// Firebase Configuration<br> &nbsp; &nbsp; &nbsp; &nbsp;const firebaseConfig = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;apiKey: &quot;AIzaSyCB2GoSkw4qdFkUmFxNAmIUgGgzFXCZZp8&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authDomain: &quot;chargeshare-a327a.firebaseapp.com&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;databaseURL: &quot;https://chargeshare-a327a-default-rtdb.asia-southeast1.firebasedatabase.app&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;projectId: &quot;chargeshare-a327a&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;storageBucket: &quot;chargeshare-a327a.appspot.com&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;messagingSenderId: &quot;77947942873&quot;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;appId: &quot;1:77947942873:web:b8366adbb41f39b8a8cbc8&quot;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;// Use a placeholder for the Open Charge Map API key, which can be updated in the settings<br> &nbsp; &nbsp; &nbsp; &nbsp;let openChargeMapApiKey = &quot;6aa27df2-0e7d-4ce3-9787-5e869d304fd7&quot;; <br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Firebase Service Imports<br> &nbsp; &nbsp; &nbsp; &nbsp;import { initializeApp } from &quot;https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;getAuth, onAuthStateChanged, createUserWithEmailAndPassword,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signOut, updateProfile, updatePassword, reauthenticateWithCredential, EmailAuthProvider<br> &nbsp; &nbsp; &nbsp; &nbsp;} from &quot;https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;getFirestore, doc, setDoc, getDoc, addDoc, collection,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;query, onSnapshot, serverTimestamp, deleteDoc, GeoPoint, where, updateDoc, getDocs<br> &nbsp; &nbsp; &nbsp; &nbsp;} from &quot;https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;import { <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;getStorage, ref, uploadBytes, getDownloadURL <br> &nbsp; &nbsp; &nbsp; &nbsp;} from &quot;https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js&quot;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Initialize Firebase<br> &nbsp; &nbsp; &nbsp; &nbsp;const app = initializeApp(firebaseConfig);<br> &nbsp; &nbsp; &nbsp; &nbsp;const auth = getAuth(app);<br> &nbsp; &nbsp; &nbsp; &nbsp;const db = getFirestore(app);<br> &nbsp; &nbsp; &nbsp; &nbsp;const storage = getStorage(app);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// Global App State<br> &nbsp; &nbsp; &nbsp; &nbsp;let mainMap, nearMeMap, liveNavigationMap, directionsService, chargingChart, geocoder, placesService, vendorMap;<br> &nbsp; &nbsp; &nbsp; &nbsp;let allChargers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let userVehicles = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let chargerMarkers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let nearMeChargerMarkers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let vendorChargerMarkers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;let userLocationMarker = null; // This will be the moving blue dot for live navigation<br> &nbsp; &nbsp; &nbsp; &nbsp;let nearMeUserMarker = null; // This is the static pin for the &quot;Chargers Near Me&quot; map<br> &nbsp; &nbsp; &nbsp; &nbsp;let watchId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp;const MASTER_KEY = &quot;25annu30athu&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp;let googleMapsLoaded = false;<br> &nbsp; &nbsp; &nbsp; &nbsp;let alternativeRouteRenderers = []; // To hold renderers for alternative routes<br> &nbsp; &nbsp; &nbsp; &nbsp;let segmentRenderers = []; // FIX: To hold renderers for intermediate planning segments<br> &nbsp; &nbsp; &nbsp; &nbsp;let waypoints = []; // To store user-added waypoints<br> &nbsp; &nbsp; &nbsp; &nbsp;let isMuted = false; // To control voice navigation<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- RECTIFIED: Central state object for multi-leg route planning ---<br> &nbsp; &nbsp; &nbsp; &nbsp;let currentRoute = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vehicle: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;navigationDirections: null, // Stores the complete, final route for navigation<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectedChargerId: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargersOnRoute: [], // Holds options for the CURRENT leg being planned<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectedPlace: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentLegIndex: 0,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentStepIndex: 0,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isAtLegEnd: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// --- Properties for the rectified multi-leg planning logic ---<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;finalOrigin: null, &nbsp; &nbsp; &nbsp; &nbsp;// The user&#39;s ultimate starting point<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;finalDestination: null, &nbsp; // The user&#39;s ultimate destination<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentOrigin: null, &nbsp; &nbsp; &nbsp;// The starting point for the leg currently being planned<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;plannedWaypoints: [], &nbsp; &nbsp; // An ordered list of selected charging stops<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isPlanning: false, &nbsp; &nbsp; &nbsp; &nbsp;// A flag to prevent concurrent planning operations<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;completeChargerList: [], &nbsp;// A static list of all available chargers for the entire planning session<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargeAfterStop: 100, &nbsp; &nbsp; // Default charge percentage assumed after a stop<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// --- NEW: To store the full response with alternatives ---<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRoutesResponse: null,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectedRouteIndex: null<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- All functions are defined here for proper scoping ---<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const showMessage = (message, duration = 3000, type = &#39;info&#39;) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const msgBox = document.getElementById(&#39;message-box&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const msgText = document.getElementById(&#39;message-text&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(!msgBox || !msgText) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;msgText.textContent = message;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;msgBox.className = `message-box show ${type}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; hideMessage(), duration);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const hideMessage = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const msgBox = document.getElementById(&#39;message-box&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(msgBox) msgBox.className = &#39;message-box&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showSection = (sectionId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.section&#39;).forEach(s =&gt; s.classList.remove(&#39;active&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const sectionElement = document.getElementById(sectionId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (sectionElement) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sectionElement.classList.add(&#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Trigger map resize for all maps to ensure they render correctly when their section becomes visible<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (mainMap &amp;&amp; sectionId === &#39;find-chargers&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(mainMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (nearMeMap &amp;&amp; sectionId === &#39;chargers-near-me&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(nearMeMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (liveNavigationMap &amp;&amp; sectionId === &#39;live-navigation&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(liveNavigationMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorMap &amp;&amp; sectionId === &#39;dashboard&#39; &amp;&amp; document.getElementById(&#39;my-vmap&#39;).classList.contains(&#39;active&#39;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(vendorMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 150);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const toggleMobileMenu = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;mobile-menu&#39;)?.classList.toggle(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const renderAuthForms = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const authSection = document.getElementById(&#39;auth-section&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(!authSection) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authSection.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;portal-choice&quot; class=&quot;max-w-md w-full bg-white p-8 rounded-xl shadow-lg text-center&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h1 class=&quot;text-3xl font-bold text-indigo-600 mb-4&quot;&gt;&#9889; ChargeFranchise&lt;/h1&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-gray-600 mb-6&quot;&gt;Welcome! Please select your portal.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;showLogin(&#39;user&#39;)&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;User Portal&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;showLogin(&#39;vendor&#39;)&quot; class=&quot;w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700&quot;&gt;Vendor / Executive Portal&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;login-container&quot; class=&quot;max-w-md w-full&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;signup-container&quot; class=&quot;max-w-md w-full&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showLogin = (role) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;portal-choice&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const container = document.getElementById(&#39;login-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let passwordLabel = role === &#39;user&#39; ? &#39;Password&#39; : &#39;Password / Key / Master Key&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let loginButtonText = role === &#39;user&#39; ? &#39;Login&#39; : &#39;Login / Verify&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-white p-8 rounded-xl shadow-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-bold text-indigo-600 mb-6 text-center&quot;&gt;Login to ${role === &#39;user&#39; ? &#39;User&#39; : &#39;Vendor&#39;} Portal&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot; id=&quot;login-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;email&quot; id=&quot;loginEmail&quot; placeholder=&quot;Email&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;loginPassword&quot; placeholder=&quot;${passwordLabel}&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;login-btn&quot; onclick=&quot;login(&#39;${role}&#39;)&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;${loginButtonText}&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;${role === &#39;user&#39; ? `&lt;button onclick=&quot;googleLogin()&quot; class=&quot;w-full flex items-center justify-center gap-3 bg-white text-gray-700 py-3 rounded-lg border hover:bg-gray-100&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src=&quot;https://developers.google.com/identity/images/g-logo.png&quot; alt=&quot;Google&quot; class=&quot;h-5&quot;&gt; Sign in with Google<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;` : &#39;&#39;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;loginError&quot; class=&quot;text-red-500 text-sm&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-sm text-gray-500 pt-2&quot;&gt;New here? &lt;a href=&quot;#&quot; onclick=&quot;showSignUp(&#39;user&#39;)&quot; class=&quot;text-indigo-600 hover:underline&quot;&gt;Create a user account&lt;/a&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;backToPortalChoice()&quot; class=&quot;w-full bg-gray-400 text-white py-3 rounded-lg font-semibold hover:bg-gray-500&quot;&gt;Back&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setupEnterKeyNavigation();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showSignUp = (role) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;portal-choice&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;login-container&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const container = document.getElementById(&#39;signup-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;bg-white p-8 rounded-xl shadow-lg&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;h2 class=&quot;text-2xl font-bold text-indigo-600 mb-6 text-center&quot;&gt;Create a User Account&lt;/h2&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-center text-gray-500 mb-4&quot;&gt;Vendor accounts are created after executive verification.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot; id=&quot;signup-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;email&quot; id=&quot;signupEmail&quot; placeholder=&quot;Email&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;password&quot; id=&quot;signupPassword&quot; placeholder=&quot;Password&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;signupName&quot; placeholder=&quot;Name&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;signup-btn&quot; onclick=&quot;signUp(&#39;user&#39;)&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Create Account&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;relative flex py-2 items-center&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex-grow border-t border-gray-300&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span class=&quot;flex-shrink mx-4 text-gray-500 text-sm&quot;&gt;OR&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex-grow border-t border-gray-300&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;googleLogin()&quot; class=&quot;w-full flex items-center justify-center gap-3 bg-white text-gray-700 py-3 rounded-lg border hover:bg-gray-100&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src=&quot;https://developers.google.com/identity/images/g-logo.png&quot; alt=&quot;Google&quot; class=&quot;h-5&quot;&gt; Sign up with Google<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/button&gt;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;signupError&quot; class=&quot;text-red-500 text-sm&quot;&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-sm text-gray-500 pt-2&quot;&gt;Already have an account? &lt;a href=&quot;#&quot; onclick=&quot;showLogin(&#39;user&#39;)&quot; class=&quot;text-indigo-600 hover:underline&quot;&gt;Login&lt;/a&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;backToPortalChoice()&quot; class=&quot;w-full bg-gray-400 text-white py-3 rounded-lg font-semibold hover:bg-gray-500&quot;&gt;Back&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setupEnterKeyNavigation();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const backToPortalChoice = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;login-container&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;signup-container&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;portal-choice&#39;).style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const setupEnterKeyNavigation = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const formContainers = [&#39;login-form&#39;, &#39;signup-form&#39;, &#39;vehicle-form&#39;, &#39;home-charger-form&#39;, &#39;vendor-charger-form&#39;, &#39;route-form&#39;, &#39;edit-charger-form&#39;];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;formContainers.forEach(formId =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const container = document.getElementById(formId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!container) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const fields = [...container.querySelectorAll(&#39;.form-field&#39;)];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const submitButton = container.querySelector(&#39;button[id$=&quot;-btn&quot;]&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fields.forEach((field, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;field.addEventListener(&#39;keydown&#39;, (e) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (e.key === &#39;Enter&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;e.preventDefault();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const nextField = fields[index + 1];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (nextField) nextField.focus();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else if (submitButton) submitButton.click();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const loadUserVehicles = (uid) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const q = query(collection(db, &quot;users&quot;, uid, &quot;vehicles&quot;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onSnapshot(q, (snapshot) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userVehicles = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vehicleSelect = document.getElementById(&#39;vehicle-select&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const listEl = document.getElementById(&#39;my-vehicles-list&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vehicleSelect) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vehicleSelect.innerHTML = &#39;&lt;option value=&quot;&quot;&gt;Select a vehicle&lt;/option&gt;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userVehicles.forEach(v =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const option = document.createElement(&#39;option&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;option.value = v.id;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;option.textContent = `${v.make} ${v.model} (${v.regNo})`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vehicleSelect.appendChild(option);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (listEl) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listEl.innerHTML = userVehicles.length === 0 ? `&lt;p class=&quot;text-gray-500&quot;&gt;No vehicles added yet.&lt;/p&gt;` : &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userVehicles.forEach(vehicle =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const item = document.createElement(&#39;div&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;item.className = &#39;bg-white p-4 rounded-lg shadow-sm flex justify-between items-center&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;item.innerHTML = `&lt;div&gt;&lt;p class=&quot;font-semibold&quot;&gt;${vehicle.make} ${vehicle.model}&lt;/p&gt;&lt;p class=&quot;text-sm text-gray-600&quot;&gt;${vehicle.regNo}&lt;/p&gt;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;deleteVehicle(&#39;${vehicle.id}&#39;)&quot; class=&quot;text-red-500 hover:text-red-700 font-semibold&quot;&gt;Delete&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;listEl.appendChild(item);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateMapMarkers = (mapInstance, markerArray, markersToShow) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;markerArray.forEach(marker =&gt; marker.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;markerArray.length = 0;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const markerData = markersToShow || allChargers;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;markerData.forEach(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!charger.location) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let iconUrl = &#39;http://maps.google.com/mapfiles/ms/icons/blue-dot.png&#39;; // Blue for available public<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (charger.type === &#39;home&#39; || charger.IsPrivate) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iconUrl = &#39;http://maps.google.com/mapfiles/ms/icons/purple-dot.png&#39;; // Purple for private/home<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (charger.status !== &#39;available&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iconUrl = &#39;http://maps.google.com/mapfiles/ms/icons/red-dot.png&#39;; // Red for in-use/maintenance<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const marker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: { lat: charger.location.latitude, lng: charger.location.longitude },<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mapInstance, title: charger.name || charger.AddressInfo?.Title,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: { url: iconUrl, scaledSize: new google.maps.Size(32, 32) }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let infoWindowContent = `&lt;div&gt;&lt;strong&gt;${charger.name || charger.AddressInfo?.Title || &#39;N/A&#39;}&lt;/strong&gt;&lt;br&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;${charger.rate || charger.Connections?.[0]?.PowerKW || &#39;N/A&#39;} kW | ${charger.type || (charger.IsPrivate ? &#39;Private&#39; : &#39;Public&#39;)}&lt;br&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Status: &lt;span class=&quot;font-bold ${charger.status === &#39;available&#39; ? &#39;text-green-600&#39; : &#39;text-red-600&#39;}&quot;&gt;${charger.status || &#39;available&#39;}&lt;/span&gt;`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (mapInstance === nearMeMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;infoWindowContent += `&lt;br&gt;&lt;button onclick=&quot;navigateToCharger(${charger.location.latitude}, ${charger.location.longitude})&quot; class=&quot;mt-2 bg-indigo-500 text-white text-xs py-1 px-2 rounded-md hover:bg-indigo-600&quot;&gt;Navigate&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;infoWindowContent += `&lt;/div&gt;`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const infoWindow = new google.maps.InfoWindow({ content: infoWindowContent });<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;marker.addListener(&#39;click&#39;, () =&gt; infoWindow.open(mapInstance, marker));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;markerArray.push(marker);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const displayRouteInfo = (legs, chargers, vehicle, directionsResult) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const routeDetailsEl = document.getElementById(&#39;route-details&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let totalDistance = legs.reduce((sum, leg) =&gt; sum + leg.distance.value, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let totalDuration = legs.reduce((sum, leg) =&gt; sum + leg.duration.value, 0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let chargingTime = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargers.forEach(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const energyNeeded = vehicle.batteryCapacity * 0.7; // Assume charging from 10% to 80%<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargingTime += (energyNeeded / (charger.rate || 11)) * 3600; // Default to 11kW if rate is unknown<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const totalTripTime = totalDuration + chargingTime;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let html = `&lt;h4 class=&quot;font-bold text-lg mb-2&quot;&gt;Trip Summary&lt;/h4&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;&lt;strong&gt;Total Distance:&lt;/strong&gt; ${(totalDistance / 1000).toFixed(1)} km&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;&lt;strong&gt;Driving Time:&lt;/strong&gt; ${formatDuration(totalDuration)}&lt;/p&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(chargers.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;p&gt;&lt;strong&gt;Est. Charging Time:&lt;/strong&gt; ${formatDuration(chargingTime)}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p class=&quot;font-bold&quot;&gt;&lt;strong&gt;Total Trip Time:&lt;/strong&gt; ${formatDuration(totalTripTime)}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h5 class=&quot;font-semibold mt-2&quot;&gt;Charging Stops:&lt;/h5&gt;&lt;ul class=&quot;list-disc pl-5&quot;&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargers.forEach(c =&gt; { html += `&lt;li&gt;${c.name || c.AddressInfo?.Title} (${c.rate || c.Connections?.[0]?.PowerKW || &#39;N/A&#39;} kW)&lt;/li&gt;`; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;/ul&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;button onclick=&quot;startInAppNavigation()&quot; class=&quot;mt-4 w-full bg-green-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-600&quot;&gt;Start Live Navigation&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routeDetailsEl.innerHTML = html;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routeDetailsEl.classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Clear alternative routes and render the final one<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearAlternativeRoutes();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const finalRenderer = new google.maps.DirectionsRenderer({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directions: directionsResult,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suppressMarkers: true,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;polylineOptions: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeColor: &#39;#4f46e5&#39;, // A strong indigo for the final route<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: 6,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeOpacity: 0.9<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRouteRenderers.push(finalRenderer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;addRouteMarkers(directionsResult, chargers);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const addRouteMarkers = (directionsResult, chargers) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers.forEach(marker =&gt; marker.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers = [];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Start Marker (Green)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const startMarker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: directionsResult.routes[0].legs[0].start_location,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: &#39;Start&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;url: &#39;http://maps.google.com/mapfiles/ms/icons/green-dot.png&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scaledSize: new google.maps.Size(40, 40)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers.push(startMarker);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// End Marker (Red)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const endMarker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: currentRoute.finalDestination,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: &#39;Destination&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;url: &#39;http://maps.google.com/mapfiles/ms/icons/red-dot.png&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scaledSize: new google.maps.Size(40, 40)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers.push(endMarker);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Charger Markers<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargers.forEach(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const position = { lat: charger.location.latitude, lng: charger.location.longitude };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const stopMarker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: position,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: `Charger: ${charger.name || charger.AddressInfo?.Title}`,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;url: &#39;http://maps.google.com/mapfiles/ms/icons/blue-dot.png&#39;, // Blue charging icon<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scaledSize: new google.maps.Size(40, 40)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// CORRECTED: Added a click listener to the marker<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopMarker.addListener(&#39;click&#39;, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Show a confirmation info window on the map<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const infoWindow = new google.maps.InfoWindow({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;content: `&lt;div&gt;&lt;strong&gt;${charger.name || charger.AddressInfo?.Title}&lt;/strong&gt;&lt;p&gt;Showing nearby places.&lt;/p&gt;&lt;/div&gt;`<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;infoWindow.open(mainMap, stopMarker);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Call the function to find and display nearby places for this charger<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;findNearbyPlaces(charger.location);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Reset any previously selected place<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.selectedPlace = null; <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers.push(stopMarker);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const startInAppNavigation = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const directionsResult = currentRoute.navigationDirections;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!directionsResult) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;No complete route available to navigate.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;live-navigation&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateMuteButtonUI();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const liveMapElement = document.getElementById(&#39;live-navigation-map&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!liveNavigationMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;liveNavigationMap = new google.maps.Map(liveMapElement, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;zoom: 15,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;center: directionsResult.routes[0].legs[0].start_location,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mapTypeControl: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mapTypeId: google.maps.MapTypeId.TERRAIN<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;liveNavigationMap.setCenter(directionsResult.routes[0].legs[0].start_location);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// This timeout ensures the map renders correctly after the section is displayed<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(liveNavigationMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;liveNavigationMap.setCenter(directionsResult.routes[0].legs[0].start_location);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 200);<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const liveDirectionsRenderer = new google.maps.DirectionsRenderer({ map: liveNavigationMap, suppressMarkers: true });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;liveDirectionsRenderer.setDirections(directionsResult);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Show selected place info if available<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const placeInfoBox = document.getElementById(&#39;selected-place-info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.selectedPlace) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;selected-place-text&#39;).textContent = `${currentRoute.selectedPlace.name} (${currentRoute.selectedPlace.vicinity})`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;placeInfoBox.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;placeInfoBox.classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (navigator.geolocation) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (userLocationMarker) userLocationMarker.setMap(null);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userLocationMarker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: liveNavigationMap.getCenter(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: liveNavigationMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: &#39;Your Location&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path: google.maps.SymbolPath.CIRCLE,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scale: 8,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fillColor: &#39;#4285F4&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fillOpacity: 1,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: 2,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeColor: &#39;white&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (watchId) navigator.geolocation.clearWatch(watchId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watchId = navigator.geolocation.watchPosition(<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(position) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const pos = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lat: position.coords.latitude,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lng: position.coords.longitude<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userLocationMarker.setPosition(pos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;liveNavigationMap.panTo(pos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(error) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Geolocation error:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Failed to get live location. Check your device settings.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Geolocation is not supported by your browser.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Initialize turn-by-turn display<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentLegIndex = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentStepIndex = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isAtLegEnd = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speak(&quot;Starting navigation.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayCurrentStep();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const displayCurrentStep = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const directionsPanel = document.getElementById(&#39;turn-by-turn-directions&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!directionsPanel || !currentRoute.navigationDirections) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const route = currentRoute.navigationDirections.routes[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!route) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsPanel.innerHTML = &#39;&lt;p&gt;Route not available.&lt;/p&gt;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Check if we are at the end of a leg<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.isAtLegEnd) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const isFinalLeg = currentRoute.currentLegIndex &gt;= route.legs.length - 1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let arrivalMessage;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (isFinalLeg) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arrivalMessage = &quot;You have arrived at your final destination!&quot;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; directionsPanel.innerHTML = `&lt;div class=&quot;text-center p-4&quot;&gt;&lt;p class=&quot;text-lg font-bold text-green-600&quot;&gt;${arrivalMessage}&lt;/p&gt;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const leg = route.legs[currentRoute.currentLegIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arrivalMessage = `You have arrived at your stop, ${leg.end_address}.`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; directionsPanel.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;text-center p-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-lg font-bold text-indigo-600&quot;&gt;Arrived at Stop:&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;my-2&quot;&gt;${leg.end_address}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;mt-4&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;label for=&quot;charge-at-stop&quot; class=&quot;block text-sm font-medium text-gray-600&quot;&gt;Current Charge: &lt;span id=&quot;charge-at-stop-value&quot;&gt;100&lt;/span&gt;%&lt;/label&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;range&quot; id=&quot;charge-at-stop&quot; min=&quot;0&quot; max=&quot;100&quot; value=&quot;100&quot; class=&quot;w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;replanFromStop()&quot; class=&quot;mt-4 w-full bg-green-500 text-white py-2 rounded-lg font-semibold hover:bg-green-600&quot;&gt;Recalculate &amp; Continue&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const slider = document.getElementById(&#39;charge-at-stop&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const valueLabel = document.getElementById(&#39;charge-at-stop-value&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(slider &amp;&amp; valueLabel) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;slider.addEventListener(&#39;input&#39;, (e) =&gt; { valueLabel.textContent = e.target.value; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speak(arrivalMessage);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const leg = route.legs[currentRoute.currentLegIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const step = leg.steps[currentRoute.currentStepIndex];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!step) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// This case should ideally be handled by the isAtLegEnd flag<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsPanel.innerHTML = `&lt;div class=&quot;text-center p-4&quot;&gt;&lt;p class=&quot;text-lg font-bold text-green-600&quot;&gt;You have arrived!&lt;/p&gt;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speak(&quot;You have arrived!&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let html = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;p-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-sm text-gray-500&quot;&gt;Next turn in: ${step.distance.text}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;text-xl font-bold text-gray-800 my-2&quot;&gt;${step.instructions}&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-sm text-gray-600&quot;&gt;Leg ${currentRoute.currentLegIndex + 1} of ${route.legs.length} - Remaining: ${leg.distance.text}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-between mt-4 border-t pt-2&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;prev-step-btn&quot; onclick=&quot;previousStep()&quot; class=&quot;px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300&quot;&gt;&larr; Previous&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button id=&quot;next-step-btn&quot; onclick=&quot;nextStep()&quot; class=&quot;px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700&quot;&gt;Next &rarr;&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsPanel.innerHTML = html;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Speak the instruction, stripping any HTML tags<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const instructionText = step.instructions.replace(/&lt;[^&gt;]*&gt;/g, &#39;&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speak(instructionText);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Disable buttons at the start/end of the route<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.currentLegIndex === 0 &amp;&amp; currentRoute.currentStepIndex === 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;prev-step-btn&#39;).disabled = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;prev-step-btn&#39;).classList.add(&#39;opacity-50&#39;, &#39;cursor-not-allowed&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const startNextLeg = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isAtLegEnd = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentLegIndex++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentStepIndex = 0;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayCurrentStep();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const nextStep = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const route = currentRoute.navigationDirections.routes[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!route) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const leg = route.legs[currentRoute.currentLegIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.currentStepIndex &lt; leg.steps.length - 1) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentStepIndex++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { // Reached end of a leg<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isAtLegEnd = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayCurrentStep();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const previousStep = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.isAtLegEnd) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isAtLegEnd = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayCurrentStep();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const route = currentRoute.navigationDirections.routes[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!route) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.currentStepIndex &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentStepIndex--;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (currentRoute.currentLegIndex &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentLegIndex--;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const prevLeg = route.legs[currentRoute.currentLegIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentStepIndex = prevLeg.steps.length - 1;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayCurrentStep();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const stopInAppNavigation = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (watchId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;navigator.geolocation.clearWatch(watchId);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;watchId = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (userLocationMarker) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userLocationMarker.setMap(null);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userLocationMarker = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Reset state<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.selectedPlace = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;selected-place-info&#39;).classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;turn-by-turn-directions&#39;).innerHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speak(&quot;Navigation stopped.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;find-chargers&#39;); <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Live navigation stopped.&quot;, 3000, &#39;info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const formatDuration = (seconds) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isNaN(seconds) || seconds === null) return &#39;N/A&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const h = Math.floor(seconds / 3600);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const m = Math.floor((seconds % 3600) / 60);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return `${h &gt; 0 ? h + &#39;h &#39; : &#39;&#39;}${m}m`;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const signUp = async (role = &#39;user&#39;) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (role === &#39;vendor&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Vendor registration is by executive approval only.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const email = document.getElementById(&#39;signupEmail&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const password = document.getElementById(&#39;signupPassword&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const name = document.getElementById(&#39;signupName&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const errorElement = document.getElementById(&#39;signupError&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errorElement.textContent = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userCredential = await createUserWithEmailAndPassword(auth, email, password);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateProfile(userCredential.user, { displayName: name });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await setDoc(doc(db, &#39;users&#39;, userCredential.user.uid), { name, email, role: &#39;user&#39;, createdAt: serverTimestamp() });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Sign up successful!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { errorElement.textContent = error.message; }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const login = async (role) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const email = document.getElementById(&#39;loginEmail&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const password = document.getElementById(&#39;loginPassword&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const errorElement = document.getElementById(&#39;loginError&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errorElement.textContent = &#39;&#39;;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (role === &#39;vendor&#39; &amp;&amp; password === MASTER_KEY) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await executiveVerify(email);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userCredential = await signInWithEmailAndPassword(auth, email, password);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (role === &#39;user&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userDoc = await getDoc(doc(db, &quot;users&quot;, userCredential.user.uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (userDoc.exists() &amp;&amp; userDoc.data().role === &#39;user&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; showMessage(&#39;Login successful!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await signOut(auth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errorElement.textContent = `This account is not a registered user.`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (role === &#39;vendor&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const q = query(collection(db, &quot;vendors&quot;), where(&quot;uid&quot;, &quot;==&quot;, userCredential.user.uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorSnapshot = await getDocs(q);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!vendorSnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; showMessage(&#39;Vendor login successful!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await signOut(auth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;errorElement.textContent = `This account is not a registered vendor.`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { errorElement.textContent = error.message; }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const executiveVerify = async (vendorEmail) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const q = query(collection(db, &quot;vendor_requests&quot;), where(&quot;email&quot;, &quot;==&quot;, vendorEmail), where(&quot;status&quot;, &quot;==&quot;, &quot;pending&quot;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const querySnapshot = await getDocs(q);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (querySnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;No pending vendor request found for this email.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const requestDoc = querySnapshot.docs[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorName = requestDoc.data().name;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const tempKey = &#39;TEMP&#39; + Math.random().toString(36).substr(2, 8).toUpperCase();<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userCredential = await createUserWithEmailAndPassword(auth, email, tempKey);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorUid = userCredential.user.uid;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateProfile(userCredential.user, { displayName: vendorName });<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorDocName = `${vendorName.replace(/[^\w\s]/gi, &#39;&#39;).replace(/\s+/g, &#39;_&#39;)}_key`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await setDoc(doc(db, &quot;vendors&quot;, vendorDocName), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uid: vendorUid,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;email: vendorEmail,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name: vendorName,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hasSetPin: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;createdAt: serverTimestamp()<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(requestDoc.ref, { status: &quot;approved&quot; });<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Vendor ${vendorEmail} approved. Temporary key: ${tempKey}`, 10000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await signOut(auth);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (error.code === &#39;auth/email-already-in-use&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; showMessage(&quot;This email is already registered as a user. To proceed, you must first delete this user from the Firebase Authentication tab, then the executive can approve them.&quot;, 8000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Verification failed: ${error.message}`, 5000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const googleLogin = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const provider = new GoogleAuthProvider();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const result = await signInWithPopup(auth, provider);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = result.user;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userDocRef = doc(db, &quot;users&quot;, user.uid);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const userDocSnap = await getDoc(userDocRef);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!userDocSnap.exists()) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; await setDoc(userDocRef, { name: user.displayName, email: user.email, role: &#39;user&#39;, createdAt: serverTimestamp() });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Logged in with Google!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { showMessage(`Google login failed: ${error.message}`, 5000, &#39;error&#39;); }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const submitVehicle = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const regNo = document.getElementById(&#39;reg-no&#39;).value.toUpperCase();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const make = document.getElementById(&#39;vehicle-make&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const model = document.getElementById(&#39;vehicle-model&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const batteryCapacity = parseFloat(document.getElementById(&#39;battery-capacity&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const connectorType = document.getElementById(&#39;connector-type&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const rtoRegex = /^[A-Z]{2}[0-9]{1,2}[A-Z]{1,2}[0-9]{1,4}$/;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!rtoRegex.test(regNo)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Invalid Registration Number format.&#39;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!make || !model || isNaN(batteryCapacity) || !connectorType) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Please fill all vehicle fields.&#39;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) throw new Error(&quot;User not logged in.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await addDoc(collection(db, &quot;users&quot;, user.uid, &quot;vehicles&quot;), { regNo, make, model, batteryCapacity, connectorType });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Vehicle added successfully!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;vehicle-form&#39;).reset();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { showMessage(`Error: ${error.message}`, 4000, &#39;error&#39;); }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const deleteVehicle = async (vehicleId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!confirm(&quot;Delete this vehicle?&quot;)) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) throw new Error(&quot;User not logged in.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await deleteDoc(doc(db, &quot;users&quot;, user.uid, &quot;vehicles&quot;, vehicleId));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Vehicle deleted.&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { showMessage(`Error: ${error.message}`, 4000, &#39;error&#39;); }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const addCharger = async (isHomeCharger = false) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) { showMessage(&quot;You must be logged in.&quot;, 3000, &#39;error&#39;); return; }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let name, rate, connectorType, chargerType, location, address;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isHomeCharger) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name = document.getElementById(&#39;home-charger-name&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rate = parseFloat(document.getElementById(&#39;home-charger-rate&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;connectorType = document.getElementById(&#39;home-charger-type&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;address = document.getElementById(&#39;home-charger-address&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!name || isNaN(rate) || !connectorType || !address) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Please fill all home charger fields.&#39;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const results = await new Promise((resolve, reject) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;geocoder.geocode({ address }, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39;) resolve(results);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else reject(new Error(&#39;Geocode failed: &#39; + status));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location = new GeoPoint(results[0].geometry.location.lat(), results[0].geometry.location.lng());<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await addDoc(collection(db, &quot;chargers&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorId: user.uid, name, rate, location, connectorType,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &#39;available&#39;, type: &#39;home&#39;, createdAt: serverTimestamp()<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Charger added successfully!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;home-charger-form&#39;).reset();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;find-chargers&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (mainMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mainMap.setCenter({ lat: location.latitude, lng: location.longitude });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mainMap.setZoom(15);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Your charger is now pinned on the map!&quot;, 4000, &#39;info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 200);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { showMessage(`Could not add charger. ${error.message}`, 5000, &#39;error&#39;); return; }<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name = document.getElementById(&#39;charger-name&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rate = parseFloat(document.getElementById(&#39;charger-rate&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;connectorType = document.getElementById(&#39;connector-type-select&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerType = document.getElementById(&#39;charger-type-select&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const lat = parseFloat(document.getElementById(&#39;charger-lat&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const lng = parseFloat(document.getElementById(&#39;charger-lng&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!name || isNaN(rate) || !connectorType || !chargerType || isNaN(lat) || isNaN(lng)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Please fill all franchise charger fields.&#39;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location = new GeoPoint(lat, lng);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await addDoc(collection(db, &quot;chargers&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorId: user.uid, name, rate, location, connectorType, chargerType,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &#39;available&#39;, type: &#39;franchise&#39;, createdAt: serverTimestamp()<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Charger added successfully!&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;vendor-charger-form&#39;).reset();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; showMessage(`Error adding charger: ${error.message}`, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const listHomeCharger = () =&gt; addCharger(true);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const deleteCharger = async (chargerId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!confirm(&quot;Are you sure you want to delete this charger? This action cannot be undone.&quot;)) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await deleteDoc(doc(db, &quot;chargers&quot;, chargerId));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&#39;Charger deleted successfully.&#39;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) { showMessage(`Error deleting charger: ${error.message}`, 4000, &#39;error&#39;); }<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const setupVendorDashboard = async (uid) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const chargersList = document.getElementById(&#39;vendor-chargers-list&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const q = query(collection(db, &quot;chargers&quot;), where(&quot;vendorId&quot;, &quot;==&quot;, uid), where(&quot;type&quot;, &quot;==&quot;, &quot;franchise&quot;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;onSnapshot(q, (snapshot) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorChargers = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (chargersList) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargersList.innerHTML = vendorChargers.length === 0 ? `&lt;p class=&quot;text-gray-500&quot;&gt;No franchise chargers added yet.&lt;/p&gt;` : &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorChargers.forEach(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const item = document.createElement(&#39;div&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;item.className = &#39;bg-white p-4 rounded-lg shadow-sm flex justify-between items-center&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;item.innerHTML = `&lt;div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-semibold&quot;&gt;${charger.name}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-sm text-gray-600&quot;&gt;${charger.rate} kW | ${charger.connectorType || &#39;N/A&#39;} | ${charger.chargerType || &#39;N/A&#39;} | &lt;span class=&quot;font-bold ${charger.status === &#39;available&#39; ? &#39;text-green-600&#39; : &#39;text-red-600&#39;}&quot;&gt;${charger.status}&lt;/span&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex gap-2 flex-wrap&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;openEditModal(&#39;${charger.id}&#39;, &#39;${charger.name}&#39;, ${charger.rate}, &#39;${charger.status}&#39;)&quot; class=&quot;text-blue-500 hover:text-blue-700 font-semibold text-sm&quot;&gt;Edit&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;locateChargerOnMap(${charger.location.latitude}, ${charger.location.longitude})&quot; class=&quot;text-purple-500 hover:text-purple-700 font-semibold text-sm&quot;&gt;Locate&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;deleteCharger(&#39;${charger.id}&#39;)&quot; class=&quot;text-red-500 hover:text-red-700 font-semibold text-sm&quot;&gt;Delete&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargersList.appendChild(item);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorChargerMarkers.forEach(marker =&gt; marker.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorChargerMarkers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const bounds = new google.maps.LatLngBounds();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorChargers.forEach(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!charger.location) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const pos = { lat: charger.location.latitude, lng: charger.location.longitude };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const marker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: pos,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: vendorMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: charger.name<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorChargerMarkers.push(marker);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bounds.extend(pos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!snapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorMap.fitBounds(bounds);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ctx = document.getElementById(&#39;chargingChart&#39;)?.getContext(&#39;2d&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (ctx) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if(chargingChart) chargingChart.destroy();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargingChart = new Chart(ctx, { <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;type: &#39;line&#39;, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data: { <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;labels: [&#39;Jan&#39;, &#39;Feb&#39;, &#39;Mar&#39;, &#39;Apr&#39;, &#39;May&#39;, &#39;Jun&#39;], <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;datasets: [{ <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;label: &#39;Earnings (&#8377;)&#39;, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;data: [6500, 7200, 8100, 7800, 9000, 9500], <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;borderColor: &#39;#4f46e5&#39;, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;backgroundColor: &#39;rgba(79, 70, 229, 0.1)&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fill: true,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tension: 0.4 <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}] <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorQuery = query(collection(db, &quot;vendors&quot;), where(&quot;uid&quot;, &quot;==&quot;, uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorSnapshot = await getDocs(vendorQuery);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!vendorSnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorData = vendorSnapshot.docs[0].data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorData.hasSetPin) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;set-pin-form&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;change-pin-form&#39;).style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;set-pin-form&#39;).style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;change-pin-form&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Welcome! Please set your custom PIN for future logins.&quot;, 5000, &#39;info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;dashboard&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showVendorTab(&#39;vendor-settings&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- RECTIFIED: Function to fetch charger data based on the states a route passes through ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const fetchChargersForRoute = async (route) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Step 1: Analyze the route to find all states it crosses.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const states = await getStatesFromRoute(route.overview_path);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (states.size === 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Could not determine states for the selected route. Fetching nearby chargers instead.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Fallback to fetching all chargers if state detection fails<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const allChargersSnapshot = await getDocs(query(collection(db, &quot;chargers&quot;)));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return allChargersSnapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Fetching chargers in ${[...states].join(&#39;, &#39;)}...`, 4000, &#39;info&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Step 2: Fetch all local chargers from Firebase. They are always relevant.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const localChargersSnapshot = await getDocs(query(collection(db, &quot;chargers&quot;)));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const localChargers = localChargersSnapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Step 3: Fetch a broad set of chargers from OCM for the country (India).<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// This is necessary because OCM API doesn&#39;t allow filtering by state directly.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const url = `https://api.openchargemap.io/v3/poi/?output=json&amp;countrycode=IN&amp;maxresults=5000&amp;key=${openChargeMapApiKey}`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let ocmChargers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const response = await fetch(url);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!response.ok) throw new Error(`Open Charge Map API error: ${response.statusText}`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const data = await response.json();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Step 4: Filter the large OCM dataset to only include chargers in the relevant states.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ocmChargersInRelevantStates = data.filter(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const chargerState = charger.AddressInfo?.StateOrProvince;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return chargerState &amp;&amp; states.has(chargerState.toLowerCase());<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ocmChargers = ocmChargersInRelevantStates.map(item =&gt; ({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;id: `ocm-${item.ID}`,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name: item.AddressInfo.Title,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AddressInfo: item.AddressInfo,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Connections: item.Connections,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IsPrivate: item.IsPrivate,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;latitude: item.AddressInfo.Latitude,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;longitude: item.AddressInfo.Longitude<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rate: item.Connections?.[0]?.PowerKW,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &#39;available&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;type: &#39;ocm&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;})).filter(c =&gt; c.location.latitude &amp;&amp; c.location.longitude);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.error(&quot;Error fetching or filtering Open Charge Map data:&quot;, error);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Failed to load some global charger data.&quot;, 5000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Step 5: Merge and de-duplicate local and OCM chargers.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const mergedChargers = [...ocmChargers, ...localChargers];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const uniqueChargerIds = new Set();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return mergedChargers.filter(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const isDuplicate = uniqueChargerIds.has(charger.id);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uniqueChargerIds.add(charger.id);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return !isDuplicate;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- NEW: Helper function to get a unique set of states from a route path ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const getStatesFromRoute = async (path) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const states = new Set();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Take a sample of points along the route to check for states<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const sampleIndices = [<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0, // Start<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Math.floor(path.length * 0.25),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Math.floor(path.length * 0.5),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Math.floor(path.length * 0.75),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path.length - 1 // End<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const geocodePromises = sampleIndices.map(index =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return new Promise(resolve =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;geocoder.geocode({ &#39;location&#39;: path[index] }, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39; &amp;&amp; results[0]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (const component of results[0].address_components) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (component.types.includes(&#39;administrative_area_level_1&#39;)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;states.add(component.long_name.toLowerCase());<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await Promise.all(geocodePromises);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return states;<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- Step 1 - Find and display alternative routes for the user to choose ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const findAlternativeRoutes = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.isPlanning) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;A route is already being planned.&quot;, 2000, &#39;info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const start = document.getElementById(&#39;route-start&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const end = document.getElementById(&#39;route-end&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vehicleId = document.getElementById(&#39;vehicle-select&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!start || !end || !vehicleId) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Please fill all fields.&quot;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearAlternativeRoutes();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers.forEach(m =&gt; m.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargerMarkers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const request = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;origin: start,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination: end,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;travelMode: &#39;DRIVING&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;provideRouteAlternatives: waypoints.length === 0, // Only provide alternatives if no waypoints are set<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypoints: waypoints.map(wp =&gt; ({ location: wp, stopover: true }))<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsService.route(request, (response, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.alternativeRoutesResponse = response; // Store the full response<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayAlternativeRoutes(response);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Could not find routes: ${status}`, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- Helper to render the route choices for the user ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const displayAlternativeRoutes = (response) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const routeDetailsEl = document.getElementById(&#39;route-details&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let html = `&lt;h3 class=&quot;text-xl font-bold mb-3 text-gray-800&quot;&gt;Please select your preferred route:&lt;/h3&gt;&lt;div class=&quot;space-y-3&quot;&gt;`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const colors = [&#39;#4f46e5&#39;, &#39;#16a34a&#39;, &#39;#ca8a04&#39;]; // Indigo, Green, Amber<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;response.routes.forEach((route, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const leg = route.legs[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div id=&quot;route-option-${index}&quot; class=&quot;route-option p-4 border-2 rounded-lg cursor-pointer bg-white shadow-sm&quot; onclick=&quot;selectRouteForPlanning(${index})&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-bold text-lg text-indigo-700&quot;&gt;Route ${index + 1} &lt;span class=&quot;text-gray-600 font-medium text-base&quot;&gt;(${route.summary || &#39;Main Route&#39;})&lt;/span&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;flex justify-between text-sm mt-1&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;${leg.distance.text}&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;span&gt;${leg.duration.text}&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Create a new renderer for each route with a different color<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const routeRenderer = new google.maps.DirectionsRenderer({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directions: response,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routeIndex: index,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suppressMarkers: true,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;polylineOptions: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeColor: colors[index % colors.length],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: 6,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeOpacity: index === 0 ? 0.9 : 0.6 // Make the primary route more opaque<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRouteRenderers.push(routeRenderer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;/div&gt;&lt;button id=&quot;plan-stops-btn&quot; onclick=&quot;startStopPlanning()&quot; class=&quot;mt-4 w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors hidden&quot;&gt;Plan Charging Stops for Selected Route&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routeDetailsEl.innerHTML = html;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;routeDetailsEl.classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// If there&#39;s only one route (due to waypoints), auto-select it.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (response.routes.length === 1) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectRouteForPlanning(0);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- Function called when a user clicks on a route option ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const selectRouteForPlanning = (routeIndex) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.selectedRouteIndex = routeIndex;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Highlight the selected route in the UI<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.route-option&#39;).forEach(el =&gt; el.classList.remove(&#39;selected-route&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(`route-option-${routeIndex}`).classList.add(&#39;selected-route&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Make the &quot;Plan Stops&quot; button visible<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;plan-stops-btn&#39;).classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Make the selected route more prominent on the map<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRouteRenderers.forEach((renderer, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderer.setOptions({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;polylineOptions: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeOpacity: index === routeIndex ? 0.9 : 0.3,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: index === routeIndex ? 8 : 6<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- RECTIFIED: Master planning function that breaks the trip into segments ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const startStopPlanning = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.selectedRouteIndex === null) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Please select a route first.&quot;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRoute.isPlanning) return;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const selectedVehicle = userVehicles.find(v =&gt; v.id === document.getElementById(&#39;vehicle-select&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!selectedVehicle) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Vehicle not found.&quot;, 3000, &#39;error&#39;); return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isPlanning = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;route-details&#39;).innerHTML = `&lt;div class=&quot;text-center p-4&quot;&gt;&lt;div class=&quot;inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600&quot;&gt;&lt;/div&gt;&lt;p&gt;Analyzing route...&lt;/p&gt;&lt;/div&gt;`;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const selectedRoute = currentRoute.alternativeRoutesResponse.routes[currentRoute.selectedRouteIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.completeChargerList = await fetchChargersForRoute(selectedRoute);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const startLocation = selectedRoute.legs[0].start_location;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const endLocation = selectedRoute.legs[selectedRoute.legs.length - 1].end_location;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// FIX: Geocode all string waypoints into LatLng objects first<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const geocodePromises = waypoints.map(wp =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return new Promise((resolve, reject) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;geocoder.geocode({ address: wp }, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(results[0].geometry.location);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reject(`Geocode failed for waypoint &quot;${wp}&quot;: ${status}`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const geocodedWaypoints = await Promise.all(geocodePromises);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Initialize state<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.vehicle = selectedVehicle;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.plannedWaypoints = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.navigationDirections = null;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;delete currentRoute.chargeAfterStop;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Create major segments: [start, waypoint1, waypoint2, ..., end]<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const majorPoints = [startLocation, ...geocodedWaypoints, endLocation];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let allPlannedStops = [];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for (let i = 0; i &lt; majorPoints.length - 1; i++) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const segmentStart = majorPoints[i];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const segmentEnd = majorPoints[i + 1];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Planning stops between ${await getAddress(segmentStart)} and ${await getAddress(segmentEnd)}...`, 4000, &#39;info&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const segmentStops = await planSegment(segmentStart, segmentEnd);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (segmentStops === null) { // Planning failed for a segment<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;throw new Error(`Could not find a valid charging path for the segment ending at ${await getAddress(segmentEnd)}.`);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;allPlannedStops.push(...segmentStops);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// After a segment, assume a full charge for the next one<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.chargeAfterStop = 100;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.plannedWaypoints = allPlannedStops;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Assemble the final grand route<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// FIX: Clear temporary segment renderers before drawing the final route<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clearSegmentRenderers();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const finalWaypoints = allPlannedStops.map(wp =&gt; ({ location: new google.maps.LatLng(wp.location.latitude, wp.location.longitude), stopover: true }));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const finalRequest = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;origin: startLocation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination: endLocation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypoints: [...geocodedWaypoints.map(wp =&gt; ({ location: wp, stopover: true })), ...finalWaypoints],<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;travelMode: &#39;DRIVING&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsService.route(finalRequest, (finalResult, finalStatus) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (finalStatus === &#39;OK&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.navigationDirections = finalResult;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;displayRouteInfo(finalResult.routes[0].legs, allPlannedStops, selectedVehicle, finalResult);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Route planning complete!&quot;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Failed to assemble final route.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isPlanning = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Error: ${error.message}`, 5000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.isPlanning = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- NEW: Function to plan stops within a single major segment ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const planSegment = (segmentStart, segmentEnd) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return new Promise(async (resolve) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let segmentWaypoints = [];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let currentLegOrigin = segmentStart;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let safetyCounter = 0; // Prevent infinite loops<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while(safetyCounter &lt; 20) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;safetyCounter++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const request = { origin: currentLegOrigin, destination: segmentEnd, travelMode: &#39;DRIVING&#39; };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const result = await new Promise(r =&gt; directionsService.route(request, (res, stat) =&gt; r({ res, stat })));<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (result.stat !== &#39;OK&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(null); // Segment is un-routable<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// FIX: Visualize the current segment being planned with a light gray color<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const segmentRenderer = new google.maps.DirectionsRenderer({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: mainMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directions: result.res,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;suppressMarkers: true,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;preserveViewport: true, // Don&#39;t zoom in on each small segment<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;polylineOptions: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeColor: &#39;#9ca3af&#39;, // A light gray to show progress<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: 5,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeOpacity: 0.8<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;segmentRenderers.push(segmentRenderer);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const leg = result.res.routes[0].legs[0];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const distanceToCover = leg.distance.value / 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const { vehicle } = currentRoute;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const AVERAGE_EFFICIENCY_KWH_PER_KM = 0.18;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const totalRangeKm = vehicle.batteryCapacity / AVERAGE_EFFICIENCY_KWH_PER_KM;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentCharge = currentRoute.chargeAfterStop || parseInt(document.getElementById(&#39;start-charge&#39;).value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentRangeKm = totalRangeKm * (currentCharge / 100);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const requiredEndRangeKm = totalRangeKm * 0.1; // 10% buffer for segment end<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (currentRangeKm &gt;= distanceToCover + requiredEndRangeKm) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(segmentWaypoints); // Segment is complete<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const safetyBufferKm = totalRangeKm * 0.10;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const maxSafeTravelDistance = currentRangeKm - safetyBufferKm;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const reachableChargers = currentRoute.completeChargerList.filter(c =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// FIX: More robust check for duplicate stops<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const isAlreadyPlanned = [...currentRoute.plannedWaypoints, ...segmentWaypoints].some(wp =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const plannedLoc = new google.maps.LatLng(wp.location.latitude, wp.location.longitude);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentLoc = new google.maps.LatLng(c.location.latitude, c.location.longitude);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Consider it a duplicate if it&#39;s within 100 meters<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return google.maps.geometry.spherical.computeDistanceBetween(plannedLoc, currentLoc) &lt; 100;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isAlreadyPlanned) return false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!c.location || c.status !== &#39;available&#39;) return false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const chargerLoc = new google.maps.LatLng(c.location.latitude, c.location.longitude);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const distanceToCharger = google.maps.geometry.spherical.computeDistanceBetween(currentLegOrigin, chargerLoc) / 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (distanceToCharger &gt; maxSafeTravelDistance) return false;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const searchRadiusMeters = parseInt(document.getElementById(&#39;search-radius&#39;).value, 10) * 1000;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return google.maps.geometry.poly.isLocationOnEdge(chargerLoc, new google.maps.Polyline({path: leg.steps.flatMap(step =&gt; step.path)}), searchRadiusMeters / 100000);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (reachableChargers.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const chargersWithDistance = reachableChargers.map(charger =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const chargerLoc = new google.maps.LatLng(charger.location.latitude, charger.location.longitude);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const distance = google.maps.geometry.spherical.computeDistanceBetween(currentLegOrigin, chargerLoc);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return { ...charger, distanceFromOrigin: distance };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chargersWithDistance.sort((a, b) =&gt; b.distanceFromOrigin - a.distanceFromOrigin);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const bestCharger = chargersWithDistance[0];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;segmentWaypoints.push(bestCharger);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentLegOrigin = new google.maps.LatLng(bestCharger.location.latitude, bestCharger.location.longitude);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.chargeAfterStop = 100;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(null); // No chargers found, segment failed<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(null); // Exceeded safety limit, fail the segment<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const getAddress = (latLng) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return new Promise(resolve =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;geocoder.geocode({ &#39;location&#39;: latLng }, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39; &amp;&amp; results[0]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(results[0].formatted_address.split(&#39;,&#39;).slice(0, 2).join(&#39;, &#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve(&quot;Unknown Location&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const checkVendorApplicationStatus = async (uid) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const statusContainer = document.getElementById(&#39;vendor-application-status&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const q = query(collection(db, &quot;vendor_requests&quot;), where(&quot;userId&quot;, &quot;==&quot;, uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const querySnapshot = await getDocs(q);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!querySnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const appData = querySnapshot.docs[0].data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (appData.status === &#39;pending&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusContainer.innerHTML = `&lt;div class=&quot;bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4&quot; role=&quot;alert&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-bold&quot;&gt;Verification Pending&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;Your application to become a vendor is currently under review by an executive.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (appData.status === &#39;approved&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; statusContainer.innerHTML = `&lt;div class=&quot;bg-green-100 border-l-4 border-green-500 text-green-700 p-4&quot; role=&quot;alert&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-bold&quot;&gt;Application Approved!&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;Congratulations! Please check your email for your temporary key and log in through the Vendor Portal.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;statusContainer.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;mb-6 text-gray-600&quot;&gt;To become a vendor, please submit a request for verification.&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div class=&quot;space-y-4&quot; id=&quot;vendor-application-form&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;input type=&quot;text&quot; id=&quot;vendor-name&quot; placeholder=&quot;Your Full Name or Business Name&quot; class=&quot;w-full p-3 border rounded-lg form-field&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button onclick=&quot;submitVendorApplication()&quot; class=&quot;w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700&quot;&gt;Submit Request&lt;/button&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const submitVendorApplication = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) { showMessage(&quot;You must be logged in.&quot;, 3000, &#39;error&#39;); return; }<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorName = document.getElementById(&#39;vendor-name&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!vendorName) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Please enter your name or business name.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await addDoc(collection(db, &quot;vendor_requests&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;userId: user.uid,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;email: user.email,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;name: vendorName,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;status: &#39;pending&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;submittedAt: serverTimestamp()<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Request submitted successfully! Your request is under review.&quot;, 5000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;checkVendorApplicationStatus(user.uid);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Request failed: ${error.message}`, 5000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const findNearbyPlaces = (location) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const nearbyPlacesContainer = document.getElementById(&#39;nearby-places&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearbyPlacesContainer.innerHTML = `&lt;div class=&quot;text-center p-4&quot;&gt;&lt;div class=&quot;inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600&quot;&gt;&lt;/div&gt;&lt;p class=&quot;mt-2 font-semibold text-gray-700&quot;&gt;Searching for nearby places...&lt;/p&gt;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearbyPlacesContainer.classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const nearbyRadiusValue = document.getElementById(&#39;nearby-radius&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const radiusInMeters = nearbyRadiusValue * 1000;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const placeTypes = [<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ title: &#39;Restaurants&#39;, type: &#39;restaurant&#39; },<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ title: &#39;Cafes&#39;, type: &#39;cafe&#39; },<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ title: &#39;Hotels&#39;, type: &#39;lodging&#39; },<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ title: &#39;Attractions&#39;, type: &#39;tourist_attraction&#39; }<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;];<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const searchPromises = placeTypes.map(placeType =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return new Promise((resolve) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const request = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;location: new google.maps.LatLng(location.latitude, location.longitude),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;radius: radiusInMeters.toString(),<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;type: [placeType.type]<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;placesService.nearbySearch(request, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === google.maps.places.PlacesServiceStatus.OK &amp;&amp; results &amp;&amp; results.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve({ title: placeType.title, places: results });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resolve({ title: placeType.title, places: [] }); // Resolve with empty array on error or no results<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Promise.all(searchPromises).then(results =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let allResultsHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;results.forEach(category =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (category.places.length &gt; 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let html = `&lt;h4 class=&quot;font-bold text-lg mt-4 mb-2&quot;&gt;${category.title} Nearby&lt;/h4&gt;&lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 gap-2&quot;&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;category.places.slice(0, 4).forEach(place =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const placeName = place.name.replace(/&#39;/g, &quot;\\&#39;&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const placeVicinity = (place.vicinity || &#39;&#39;).replace(/&#39;/g, &quot;\\&#39;&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;div class=&quot;bg-white p-2 rounded-lg shadow-sm cursor-pointer hover:bg-indigo-50&quot; onclick=&quot;selectNearbyPlace(&#39;${placeName}&#39;, &#39;${placeVicinity}&#39;)&quot;&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;font-semibold text-sm&quot;&gt;${place.name}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-xs text-gray-500&quot;&gt;${place.vicinity || &#39;Address not available&#39;}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html += `&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;allResultsHTML += html;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (allResultsHTML) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearbyPlacesContainer.innerHTML = allResultsHTML;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearbyPlacesContainer.innerHTML = `&lt;p class=&quot;text-gray-600&quot;&gt;No popular places found within ${nearbyRadiusValue}km of the charger.&lt;/p&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;const selectNearbyPlace = (name, vicinity) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.selectedPlace = { name, vicinity };<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`&#39;${name}&#39; selected for your stop. This will be shown during live navigation.`, 4000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const locateMe = (mapId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (navigator.geolocation) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;navigator.geolocation.getCurrentPosition((position) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const pos = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lat: position.coords.latitude,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lng: position.coords.longitude<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let targetMap;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let targetInput;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (mapId === &#39;route-start&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetMap = mainMap;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetInput = document.getElementById(&#39;route-start&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else if (mapId === &#39;near-me-map&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetMap = nearMeMap;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Add/update marker for user&#39;s location<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (nearMeUserMarker) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearMeUserMarker.setMap(null); // Remove old marker if it exists<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearMeUserMarker = new google.maps.Marker({<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;position: pos,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;map: targetMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;title: &#39;Your Location&#39;,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icon: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path: google.maps.SymbolPath.CIRCLE,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scale: 8,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fillColor: &#39;#4285F4&#39;, // A distinct blue color<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fillOpacity: 1,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeWeight: 2,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strokeColor: &#39;white&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (targetMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetMap.setCenter(pos);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetMap.setZoom(12);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (targetInput) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;geocoder.geocode({ location: pos }, (results, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39; &amp;&amp; results[0]) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetInput.value = results[0].formatted_address;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Could not determine address from your location.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Geolocation failed. Please enable location services.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Your browser does not support geolocation.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const navigateToCharger = (lat, lng) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (navigator.geolocation) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;navigator.geolocation.getCurrentPosition(position =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const start = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lat: position.coords.latitude,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lng: position.coords.longitude<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const end = { lat, lng };<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const request = {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;origin: start,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination: end,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;travelMode: &#39;DRIVING&#39;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directionsService.route(request, (result, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (status === &#39;OK&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.navigationDirections = result;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startInAppNavigation();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Could not calculate route to this charger.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, () =&gt; showMessage(&quot;Could not get your current location to start navigation.&quot;, 3000, &#39;error&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Geolocation is not supported by your browser.&quot;, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const replanFromStop = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const newCharge = parseInt(document.getElementById(&#39;charge-at-stop&#39;).value, 10);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.chargeAfterStop = newCharge;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const lastWaypoint = currentRoute.plannedWaypoints[currentRoute.currentLegIndex];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;currentRoute.currentOrigin = new google.maps.LatLng(lastWaypoint.location.latitude, lastWaypoint.location.longitude);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;find-chargers&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Resuming route planning from ${lastWaypoint.name || &#39;stop&#39;} with ${newCharge}% charge...`, 4000, &#39;info&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;route-details&#39;).innerHTML = `&lt;div class=&quot;text-center&quot;&gt;&lt;div class=&quot;inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600&quot;&gt;&lt;/div&gt;&lt;p&gt;Recalculating next leg...&lt;/p&gt;&lt;/div&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;route-details&#39;).classList.remove(&#39;hidden&#39;);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await planNextLeg();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const initUserMap = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (mainMap) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const defaultLocation = { lat: 19.0760, lng: 72.8777 }; // Mumbai<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mainMap = new google.maps.Map(document.getElementById(&quot;map&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zoom: 10,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; center: defaultLocation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mapTypeControl: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mapTypeId: google.maps.MapTypeId.TERRAIN<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; directionsService = new google.maps.DirectionsService();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; geocoder = new google.maps.Geocoder();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // NOTE: google.maps.places.PlacesService is deprecated.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // For production, migrate to the new Places API and google.maps.places.Place.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; placesService = new google.maps.places.PlacesService(mainMap);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const startInput = document.getElementById(&#39;route-start&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const endInput = document.getElementById(&#39;route-end&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const waypointInput = document.getElementById(&#39;waypoint-input&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // NOTE: google.maps.places.Autocomplete is deprecated.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // For production, migrate to the new Place Autocomplete and PlaceAutocompleteElement.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (startInput) new google.maps.places.Autocomplete(startInput);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (endInput) new google.maps.places.Autocomplete(endInput);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (waypointInput) new google.maps.places.Autocomplete(waypointInput);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;start-charge&#39;).addEventListener(&#39;input&#39;, (e) =&gt; { document.getElementById(&#39;start-charge-value&#39;).textContent = e.target.value; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;end-charge&#39;).addEventListener(&#39;input&#39;, (e) =&gt; { document.getElementById(&#39;end-charge-value&#39;).textContent = e.target.value; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;search-radius&#39;).addEventListener(&#39;input&#39;, (e) =&gt; { document.getElementById(&#39;search-radius-value&#39;).textContent = e.target.value; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(&#39;nearby-radius&#39;).addEventListener(&#39;input&#39;, (e) =&gt; { document.getElementById(&#39;nearby-radius-value&#39;).textContent = e.target.value; });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setupEnterKeyNavigation();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.log(&quot;User Map Initialized&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- Helper to clear all route lines from the map ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const clearAlternativeRoutes = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRouteRenderers.forEach(renderer =&gt; renderer.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alternativeRouteRenderers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- FIX: Helper to clear intermediate segment route lines ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const clearSegmentRenderers = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;segmentRenderers.forEach(renderer =&gt; renderer.setMap(null));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;segmentRenderers = [];<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;// --- NEW: Functions to manage waypoints ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const addWaypoint = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const waypointInput = document.getElementById(&#39;waypoint-input&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const location = waypointInput.value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (location) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypoints.push(location);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypointInput.value = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderWaypoints();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const removeWaypoint = (index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypoints.splice(index, 1);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderWaypoints();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const renderWaypoints = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const container = document.getElementById(&#39;waypoints-container&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.innerHTML = &#39;&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;waypoints.forEach((wp, index) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const div = document.createElement(&#39;div&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;div.className = &#39;flex items-center justify-between bg-gray-200 p-2 rounded-lg&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;div.innerHTML = `&lt;span class=&quot;text-sm&quot;&gt;${wp}&lt;/span&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button onclick=&quot;removeWaypoint(${index})&quot; class=&quot;text-red-500 font-bold text-lg&quot;&gt;&times;&lt;/button&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;container.appendChild(div);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br><br> &nbsp; &nbsp; &nbsp; &nbsp;const initChargersNearMeMap = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (nearMeMap) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const defaultLocation = { lat: 19.0760, lng: 72.8777 }; // Mumbai<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nearMeMap = new google.maps.Map(document.getElementById(&quot;chargers-near-me-map&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zoom: 10,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; center: defaultLocation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mapTypeControl: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mapTypeId: google.maps.MapTypeId.TERRAIN<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Chargers Near Me Map Initialized&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const initVendorMap = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorMap || !document.getElementById(&#39;vendor-map&#39;)) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const defaultLocation = { lat: 19.0760, lng: 72.8777 }; // Mumbai<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorMap = new google.maps.Map(document.getElementById(&quot;vendor-map&quot;), {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;zoom: 5,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;center: defaultLocation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mapTypeControl: false,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Vendor Map Initialized&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const showVendorTab = (tabId) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.vendor-tab-content&#39;).forEach(content =&gt; content.classList.remove(&#39;active&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.vendor-tab&#39;).forEach(tab =&gt; tab.classList.remove(&#39;active&#39;));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(tabId)?.classList.add(&#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelector(`.vendor-tab[onclick*=&quot;&#39;${tabId}&#39;&quot;]`)?.classList.add(&#39;active&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (tabId === &#39;my-vmap&#39;) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!vendorMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initVendorMap();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setTimeout(() =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const center = vendorMap.getCenter();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;google.maps.event.trigger(vendorMap, &#39;resize&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (center) vendorMap.setCenter(center);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, 100);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const calculateROI = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const investment = parseFloat(document.getElementById(&#39;investment&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const monthlyRevenue = parseFloat(document.getElementById(&#39;monthly-revenue&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const resultDiv = document.getElementById(&#39;roi-result&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isNaN(investment) || isNaN(monthlyRevenue) || investment &lt;= 0) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Please enter valid investment and revenue values.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const annualRevenue = monthlyRevenue * 12;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const profit = annualRevenue - investment;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const roi = (profit / investment) * 100;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resultDiv.innerHTML = `<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;&lt;strong&gt;Annual Revenue:&lt;/strong&gt; &#8377;${annualRevenue.toLocaleString(&#39;en-IN&#39;)}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p&gt;&lt;strong&gt;Annual Profit:&lt;/strong&gt; &#8377;${profit.toLocaleString(&#39;en-IN&#39;)}&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;p class=&quot;text-2xl font-bold mt-2&quot;&gt;Annual ROI: &lt;span class=&quot;${roi &gt;= 0 ? &#39;text-green-600&#39; : &#39;text-red-600&#39;}&quot;&gt;${roi.toFixed(2)}%&lt;/span&gt;&lt;/p&gt;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;resultDiv.classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const locateChargerOnMap = (lat, lng) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showVendorTab(&#39;my-vmap&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorMap) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorMap.setCenter({ lat, lng });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;vendorMap.setZoom(15);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const openEditModal = (id, name, rate, status) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-id&#39;).value = id;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-name&#39;).value = name;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-rate&#39;).value = rate;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-status&#39;).value = status;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-modal&#39;).classList.remove(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const closeEditModal = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;edit-charger-modal&#39;).classList.add(&#39;hidden&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateCharger = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const id = document.getElementById(&#39;edit-charger-id&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const name = document.getElementById(&#39;edit-charger-name&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const rate = parseFloat(document.getElementById(&#39;edit-charger-rate&#39;).value);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const status = document.getElementById(&#39;edit-charger-status&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!id || !name || isNaN(rate)) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Invalid data.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(doc(db, &quot;chargers&quot;, id), { name, rate, status });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;Charger updated successfully!&quot;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;closeEditModal();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Error updating charger: ${error.message}`, 4000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const setCustomPin = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const newPin = document.getElementById(&#39;new-pin&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const confirmPin = document.getElementById(&#39;confirm-pin&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const ocmApiKey = document.getElementById(&#39;ocm-api-key&#39;).value;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (newPin !== confirmPin) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;PINs do not match.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (newPin.length &lt; 6) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;PIN must be at least 6 characters long.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;User not authenticated.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updatePassword(user, newPin);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorQuery = query(collection(db, &quot;vendors&quot;), where(&quot;uid&quot;, &quot;==&quot;, user.uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorSnapshot = await getDocs(vendorQuery);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!vendorSnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorDocRef = vendorSnapshot.docs[0].ref;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updateDoc(vendorDocRef, { hasSetPin: true, ocmApiKey: ocmApiKey });<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;PIN set successfully! You can now use this for all future logins.&quot;, 4000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;set-pin-form&#39;).style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;change-pin-form&#39;).style.display = &#39;block&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Failed to set PIN: ${error.message}. You may need to log out and log back in with your temporary key.`, 6000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const changeCustomPin = async () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const currentPin = document.getElementById(&#39;current-pin&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const newPin = document.getElementById(&#39;change-new-pin&#39;).value;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const confirmPin = document.getElementById(&#39;change-confirm-pin&#39;).value;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (newPin !== confirmPin) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;New PINs do not match.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (newPin.length &lt; 6) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;New PIN must be at least 6 characters long.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const user = auth.currentUser;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!user) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;User not authenticated.&quot;, 3000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;try {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const credential = EmailAuthProvider.credential(user.email, currentPin);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await reauthenticateWithCredential(user, credential);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;await updatePassword(user, newPin);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(&quot;PIN changed successfully!&quot;, 3000, &#39;success&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;change-pin-form&#39;).reset();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} catch (error) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage(`Failed to change PIN: ${error.message}. Please ensure your current PIN is correct.`, 6000, &#39;error&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const initializeMapsAfterLogin = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (googleMapsLoaded) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const script = document.createElement(&#39;script&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// NOTE: For optimal performance, Google recommends adding the script tag directly to the HTML with the `async` attribute.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Dynamically adding it here is a functional alternative.<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyCLrNaIQ1Eu-XpKws7J4MFbdxw01p0bEnc&amp;libraries=places,geometry,drawing&amp;callback=googleMapsApiLoaded`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;script.async = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;script.defer = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.head.appendChild(script);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;// --- NEW: Voice Navigation Functions ---<br> &nbsp; &nbsp; &nbsp; &nbsp;const speak = (text) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isMuted || !(&#39;speechSynthesis&#39; in window)) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speechSynthesis.cancel(); // Stop any previous speech<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const utterance = new SpeechSynthesisUtterance(text);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speechSynthesis.speak(utterance);<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const toggleMute = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isMuted = !isMuted;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isMuted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;speechSynthesis.cancel(); // Stop speaking immediately if muted<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;updateMuteButtonUI();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;const updateMuteButtonUI = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const muteBtn = document.getElementById(&#39;mute-btn&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!muteBtn) return;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isMuted) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;muteBtn.innerHTML = `&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; class=&quot;h-6 w-6&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot;&gt;&lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; d=&quot;M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z&quot; clip-rule=&quot;evenodd&quot; /&gt;&lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; d=&quot;M17 14l2-2m0 0l2-2m-2 2l-2 2m2-2l2 2&quot; /&gt;&lt;/svg&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;muteBtn.innerHTML = `&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; class=&quot;h-6 w-6&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;2&quot;&gt;&lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; d=&quot;M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z&quot; /&gt;&lt;/svg&gt;`;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;window.googleMapsApiLoaded = () =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;googleMapsLoaded = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(&quot;Google Maps API loaded.&quot;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Initialize maps that might be needed right away<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initUserMap();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initChargersNearMeMap();<br> &nbsp; &nbsp; &nbsp; &nbsp;};<br><br> &nbsp; &nbsp; &nbsp; &nbsp;Object.assign(window, {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showMessage, hideMessage, showSection, toggleMobileMenu,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showLogin, showSignUp, backToPortalChoice,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signUp, login, googleLogin,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;logout: async () =&gt; { await signOut(auth); showMessage(&quot;Logged out successfully.&quot;, 3000, &#39;info&#39;); },<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;findAlternativeRoutes, <br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;submitVehicle, deleteVehicle, addCharger, listHomeCharger, deleteCharger,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;submitVendorApplication, locateMe, showVendorTab, calculateROI, locateChargerOnMap,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;openEditModal, closeEditModal, updateCharger, setCustomPin, changeCustomPin,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initUserMap, initChargersNearMeMap, initVendorMap, updateMapMarkers,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;startInAppNavigation, stopInAppNavigation,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectNearbyPlace,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nextStep, previousStep, startNextLeg, navigateToCharger, replanFromStop,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;selectRouteForPlanning, startStopPlanning,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;addWaypoint, removeWaypoint, // Expose new waypoint functions<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;toggleMute // Expose mute function<br> &nbsp; &nbsp; &nbsp; &nbsp;});<br><br> &nbsp; &nbsp; &nbsp; &nbsp;onAuthStateChanged(auth, async (user) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const authSection = document.getElementById(&#39;auth-section&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const appContent = document.getElementById(&#39;app-content&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (user) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authSection.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;appContent.style.display = &#39;flex&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.getElementById(&#39;user-info&#39;).textContent = user.displayName || user.email;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;initializeMapsAfterLogin();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;let isVendor = false;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorQuery = query(collection(db, &quot;vendors&quot;), where(&quot;uid&quot;, &quot;==&quot;, user.uid));<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorSnapshot = await getDocs(vendorQuery);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (!vendorSnapshot.empty) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;isVendor = true;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const vendorData = vendorSnapshot.docs[0].data();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (vendorData.ocmApiKey) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;openChargeMapApiKey = vendorData.ocmApiKey;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(`User ${user.uid} logged in. Is vendor: ${isVendor}`);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.user-only-nav&#39;).forEach(el =&gt; el.style.display = isVendor ? &#39;none&#39; : &#39;block&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;document.querySelectorAll(&#39;.vendor-only-nav&#39;).forEach(el =&gt; el.style.display = isVendor ? &#39;block&#39; : &#39;none&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (isVendor) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;dashboard&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;setupVendorDashboard(user.uid);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;showSection(&#39;home&#39;);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;loadUserVehicles(user.uid);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;checkVendorApplicationStatus(user.uid);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;authSection.style.display = &#39;flex&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;appContent.style.display = &#39;none&#39;;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;renderAuthForms();<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></span></p></body></html>